# DownloadLib

#### Браузерное расширение для загрузки манги | v1.0.1

[![Test Extension](https://github.com/ivanvit100/DownloadLib/actions/workflows/test.yaml/badge.svg)](https://github.com/ivanvit/DownloadLib/actions/workflows/test.yaml)
![Code Coverage](https://img.shields.io/badge/Coverage-87.65%25-brightgreen)

**DownloadLib** — расширение для браузера, позволяющее скачивать мангу с порталов [*MangaLib*](https://mangalib.me/) и [*RanobeLib*](https://ranobelib.me/) в форматах *FB2*, *EPUB* и *PDF*. Поддерживает автоматическую обработку изображений и текста, а также гибкие настройки скорости загрузки.

![MangaLib interface](/screenshots/MangaLib_example.png)
![RanobeLib interface](/screenshots/RanobeLib_example.png)

---

## Возможности

- **Скачивание манги с MangaLib и RanobeLib**
  - Автоматическое определение сервиса по открытому сайту.
- **Выбор формата файла**
  - FB2 (FictionBook 2.0)
  - EPUB (электронная книга)
  - PDF (страницы с текстом и изображениями)
- **Выборочная загрузка**
  - Возможность загружать определённые главы/тома произведения.
- **Обновление книг**
  - Дополнение скачанной работы недостающими главами.
- **Автоматическое кадрирование**
  - Разбиение длинных изображений манги на несколько страниц для удобного чтения с электронных книг.
- **Загрузка обложки и метаданных**
  - Название, авторы, описание, дата выхода, жанры и др.
- **Фоновая загрузка**
  - Возможность перевести скачивание в фоновый режим.
- **Пауза и остановка загрузки**
  - Управление процессом скачивания: пауза, продолжение, завершение.
- **Гибкая настройка лимита запросов**
  - Можно задать количество запросов в минуту для культурного обращения к API.
- **Интерфейс popup**
  - Просмотр информации о тайтле, количестве глав, авторах, рейтинге и обложке.
- **Удаление рекламы**
  - Расширение автоматически скрывает рекламу со страниц тайтлов.

---

## Поддерживаемые браузеры

- **Firefox** — полная поддержка всех функций.
- **Chromium-браузеры (Chrome, Edge, Яндекс и др.)** — поддерживается отдельная версия с ограниченным функционалом (нет фоновой загрузки, ошибки MangaLib, непредсказуемая работа модуля rate limiter - исправления которых ожидается в будущих версиях).

---

## Установка

### Готовые сборки

1. Откройте раздел [Releases](https://github.com/ivanvit100/DownloadLib/releases).
2. Для Firefox скачайте `.xpi` файл последней версии, для Chromium-based браузеров (Chrome, Edge, Яндекс и др.) - `.crx` файл.

### Самостоятельная установка

#### Firefox

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/ivanvit100/DownloadLib
    ```
2. Откройте страницу `about:debugging` в Firefox.
3. Во вкладке "Этот Firefox" выберите "Загрузить временное дополнение".
4. Укажите файл [`manifest.json`](/manifest.firefox.json).

#### Chromium-браузеры

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/ivanvit100/DownloadLib
    ```
2. Откройте страницу `chrome://extensions/` в браузере.
3. Включите "Режим разработчика".
4. Нажмите "Загрузить распакованное расширение" и выберите папку проекта.
5. Убедитесь, что выбран файл [`manifest.json`](manifest.chrome.json) (переименуйте его в `manifest.json` при необходимости).

---

## Использование

1. Откройте страницу манги на MangaLib или RanobeLib.
2. Кликните по иконке расширения.
3. Выберите нужный формат (FB2, EPUB, PDF).
4. Установите лимит запросов (по умолчанию 100/мин).
5. Нажмите **Скачать книгу**.

---

## Технические детали

- Для PDF используется html2pdf, для EPUB — JSZip.
- Основная логика загрузки и экспорта находится в папке [`core/`](core/), форматтеры для загружаемых файлов в [`exporters/`](exporters/),  сайты, поддерживаемые расширением, имеют отдельные директории в [`services/`](services/).
- Для Chrome/Chromium используется [`manifest.chrome.json`](manifest.chrome.json) и сервис-воркер.
- Для Firefox — [`manifest.json`](manifest.json) и классический фон.
- Покрытие тестами через vitest.

---

## Обратная связь

- [GitHub проекта](https://github.com/ivanvit100/DownloadLib/)
- Автор: [ivanvit.ru](https://ivanvit.ru)

---

**DownloadLib — ваш удобный способ сохранить любимую мангу!**